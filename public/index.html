<!DOCTYPE html>
<html>
<head>
    <title>Indices chart</title>
    <style>
        #chart {
            width: 100%;
            height: 400px;
        }
        #error {
            color: #d61d00;
        }
    </style>
</head>
<body>
    <form id="form">
        <p>Format: YYYY-MM-DD hh:mm (e.g. 2015-08-09 12:15), <b>must be UTC</b></p>
        <input type="text" id="start" value="2015-08-24T10:17" />
        <input type="text" id="end" value="2015-08-24T10:54" />
        <button>Submit</button>
        <p id="error"></p>
    </form>
    <div id="chart"></div>
    <script src="http://code.highcharts.com/adapters/standalone-framework.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highcharts/4.1.8/highcharts.js"></script>
    <script>
        function fmtDate(d) {
            return d.replace(' ', 'T') + ':00';
        }

        function mkChart(times) {
            var series = {};
            times.forEach(function (time) {
                var d = +new Date(time.date + ':00');
                time.indices.forEach(function (index) {
                    if (!series[index.name]) series[index.name] = [];
                    series[index.name].push([d, index.price]);
                });
            });

             new Highcharts.Chart({
                'chart': { 'renderTo': 'chart', 'type': 'line', 'zoomType': 'x' },
                'xAxis': { 'type': 'datetime', 'title': { 'text': 'Time' } },
                'yAxis': { 'title': { 'text': 'Price' } },
                'title': { 'text': null },
                'series': Object.keys(series).map(function (seri) {
                    return {'name': seri, 'data': series[seri]};
                })
            });
        }

        var errorEl = document.querySelector('#error');

        document.querySelector('#form').addEventListener('submit', function (evt) {
            evt.preventDefault();
            var start = fmtDate(document.querySelector('#start').value);
            var end = fmtDate(document.querySelector('#end').value);

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        mkChart(JSON.parse(xhr.responseText));
                        errorEl.textContent = '';
                    } else {
                        errorEl.textContent = xhr.responseText;
                    }
                }
            };
            xhr.open('get', '/data?start=' + start + '&end=' + end);
            xhr.send();
        });
    </script>
</body>
</html>
